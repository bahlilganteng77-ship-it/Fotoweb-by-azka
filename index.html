<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fotoweb-by-azkaâœ¦</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        :root { 
            --accent: #ff7eb9; 
            --bg: #030712; 
            --panel: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text-muted: #94a3b8;
        }
        
        body { 
            background: var(--bg); color: #fff; font-family: 'Plus Jakarta Sans', sans-serif; 
            margin: 0; min-height: 100vh; display: grid;
            grid-template-columns: 340px 1fr 360px; overflow-x: hidden;
        }

        /* RESPONSIVE LAYOUT */
        @media (max-width: 1024px) {
            body { grid-template-columns: 1fr; grid-template-rows: auto auto auto; overflow-y: auto; }
            .panel-left, .panel-right { border: none !important; padding: 20px !important; }
            .strip-shadow-box { height: 65vh !important; margin: 20px 0; }
            .panel-right { height: auto !important; max-height: none !important; }
        }

        /* SIDEBARS */
        .panel-left, .panel-right { 
            padding: 25px; background: rgba(0,0,0,0.4); 
            display: flex; flex-direction: column; gap: 20px; 
            max-height: 100vh; overflow-y: auto; 
        }
        .panel-left::-webkit-scrollbar, .panel-right::-webkit-scrollbar { width: 4px; }
        .panel-left::-webkit-scrollbar-thumb, .panel-right::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

        /* CAMERA */
        .cam-container {
            width: 100%; height: 200px; background: #000; border-radius: 20px;
            overflow: hidden; position: relative; border: 2px solid var(--border);
        }
        #camera { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .cd-circle {
            position: absolute; inset: 0; display: none; align-items: center; justify-content: center;
            font-size: 60px; font-weight: 800; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 10;
        }

        /* STAGE */
        .stage { display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at center, #1e1b4b 0%, transparent 80%); }
        .strip-shadow-box {
            height: 90vh; aspect-ratio: 1/3; background: #fff; padding: 10px;
            border-radius: 4px; box-shadow: 0 40px 80px -20px rgba(0,0,0,0.9);
            position: relative; transition: 0.3s;
        }
        #canvas { height: 100%; width: 100%; border-radius: 2px; cursor: crosshair; touch-action: none; }

        /* UI ELEMENTS */
        .label { font-size: 10px; font-weight: 800; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 10px; display: block; }
        .asset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        .chip {
            background: var(--panel); border: 1px solid var(--border); border-radius: 10px;
            padding: 10px 4px; cursor: pointer; text-align: center; font-size: 10px; transition: 0.2s;
        }
        .chip:hover { border-color: var(--accent); background: rgba(255,255,255,0.05); }
        .chip.active { background: var(--accent); color: #fff; border-color: var(--accent); }

        .sticker-cloud { display: flex; flex-wrap: wrap; gap: 8px; justify-content: flex-start; padding: 12px; background: var(--panel); border-radius: 15px; border: 1px solid var(--border); }
        .sticker-unit { font-size: 24px; cursor: pointer; transition: 0.2s; user-select: none; }
        .sticker-unit:hover { transform: scale(1.3); }

        .btn-capture { background: linear-gradient(135deg, #ff7eb9, #ff758c); color: #fff; border: none; padding: 16px; border-radius: 15px; font-weight: 800; cursor: pointer; width: 100%; font-size: 14px; }
        .btn-save { background: #fff; color: #000; border: none; padding: 14px; border-radius: 15px; font-weight: 800; cursor: pointer; width: 100%; margin-top: 10px; }
        
        #flash { position: fixed; inset: 0; background: #fff; opacity: 0; pointer-events: none; z-index: 100; transition: opacity 0.1s; }
        .brand { font-family: 'Pacifico', cursive; font-size: 26px; color: var(--accent); margin: 0; }
    </style>
</head>
<body>

<div id="flash"></div>

<div class="panel-left">
    <div class="brand">Foto Web</div>
    
    <div class="cam-container">
        <video id="camera" autoplay playsinline></video>
        <div id="cd" class="cd-circle">3</div>
    </div>
    
    <button class="btn-capture" onclick="startPhotoSession()">ðŸ“¸ SNAP 3 POSES</button>

    <div>
        <span class="label">Filter</span>
        <div class="asset-grid" id="filter-grid"></div>
    </div>
</div>

<div class="stage">
    <div class="strip-shadow-box" id="canvas-wrap">
        <canvas id="canvas"></canvas>
    </div>
</div>

<div class="panel-right">
    <div>
        <span class="label">Frame</span>
        <div class="asset-grid" id="frame-grid"></div>
    </div>

    <div>
        <span class="label">Sticker</span>
        <div class="sticker-cloud" id="sticker-grid"></div>
        <p style="font-size: 9px; color: #444; margin-top: 8px; text-align: center;">Tip: Drag sticker to move â€¢ Double click to delete</p>
    </div>

    <div style="margin-top: auto;">
        <button class="btn-save" onclick="downloadPhoto()">DOWNLOAD STRIP ðŸ“¥</button>
        <button onclick="resetApp()" style="background:none; border:none; color:var(--text-muted); font-size: 11px; cursor:pointer; width:100%; margin-top:10px;">RESET STUDIO</button>
    </div>
</div>

<script>
    const APP = {
        w: 533, h: 1600,
        slots: [{x:40, y:70, w:453, h:440}, {x:40, y:565, w:453, h:440}, {x:40, y:1060, w:453, h:440}],
        filters: [
            {n:'Normal', f:'none'}, {n:'Mono', f:'grayscale(1)'}, {n:'Retro', f:'sepia(0.5) contrast(1.1)'},
            {n:'Cinema', f:'contrast(1.2) brightness(0.9) saturate(1.1)'}, {n:'Cool', f:'hue-rotate(180deg) brightness(1.1)'},
            {n:'Y2K', f:'saturate(2) contrast(0.9) brightness(1.1)'}, {n:'Soft', f:'brightness(1.1) blur(0.3px) saturate(0.8)'},
            {n:'Fade', f:'brightness(1.1) contrast(0.8) sepia(0.2)'}, {n:'Vivid', f:'saturate(1.8)'},
            {n:'Dramatic', f:'grayscale(0.5) contrast(1.5)'}, {n:'Teal', f:'hue-rotate(140deg) saturate(0.8)'},
            {n:'Warm', f:'sepia(0.3) saturate(1.4) hue-rotate(-10deg)'}, {n:'Lo-Fi', f:'contrast(0.9) brightness(1.1) sepia(0.1)'},
            {n:'Pastel', f:'hue-rotate(-20deg) brightness(1.2) saturate(0.8)'}, {n:'Midnight', f:'brightness(0.7) contrast(1.3) hue-rotate(200deg)'}
        ],
        stickers: [
            'âœ¨','â¤ï¸','ðŸŽ€','ðŸŒ¸','â­','ðŸ”¥','ðŸŒˆ','ðŸ¦‹','ðŸ•¶ï¸','ðŸŽˆ','ðŸ±','ðŸ•','ðŸ­','ðŸ’Ž','ðŸ€','ðŸ‘‘','ðŸ‘‘','ðŸ‘’','ðŸŽ¨','ðŸš€','ðŸ§¸','ðŸ“¸','ðŸ’¡','ðŸ§¿','ðŸ¡','ðŸ§','ðŸ“','ðŸ’','ðŸ¥‘','âš¡','â˜ï¸','ðŸŒ™','ðŸ„','ðŸ’˜','âœŒï¸','ðŸ¤˜','ðŸ”¥','ðŸ¾','ðŸ¦–','ðŸª'
        ],
        frames: [
            {n:'White', c:'#ffffff', t:'#222'}, {n:'Black', c:'#0a0a0a', t:'#fff'}, {n:'Silver', c:'#e2e8f0', t:'#475569'},
            {n:'Rose', c:'#ffe4e6', t:'#9f1239'}, {n:'Mint', c:'#ecfdf5', t:'#065f46'}, {n:'Blue', c:'#e0f2fe', t:'#075985'},
            {n:'Lemon', c:'#fef9c3', t:'#854d0e'}, {n:'Lilac', c:'#f3e8ff', t:'#6b21a8'}, {n:'Latte', c:'#f5f5f4', t:'#57534e'},
            {n:'Peach', c:'#ffedd5', t:'#9a3412'}, {n:'Navy', c:'#1e293b', t:'#f8fafc'}, {n:'Ruby', c:'#450a0a', t:'#fecaca'}
        ]
    };

    let photos = [], step = 0, curFilter = 'none', curFrame = null, stickers = [], activeDrag = null;
    const v = document.getElementById('camera'), cvs = document.getElementById('canvas'), ctx = cvs.getContext('2d'), wrap = document.getElementById('canvas-wrap');

    navigator.mediaDevices.getUserMedia({ video: true }).then(s => v.srcObject = s);

    async function startPhotoSession() {
        if(step >= 3) { photos = []; step = 0; stickers = []; }
        for(let j = 0; j < 3; j++) {
            step++;
            const cd = document.getElementById('cd'); cd.style.display = 'flex';
            for(let i=3; i>0; i--) { cd.innerText = i; await new Promise(r => setTimeout(r, 800)); }
            cd.style.display = 'none';
            
            // Flash
            document.getElementById('flash').style.opacity = '1';
            setTimeout(() => document.getElementById('flash').style.opacity = '0', 100);

            const tmp = document.createElement('canvas'); tmp.width = v.videoWidth; tmp.height = v.videoHeight;
            const tCtx = tmp.getContext('2d'); tCtx.translate(tmp.width, 0); tCtx.scale(-1, 1); tCtx.drawImage(v, 0, 0);
            photos.push({ img: tmp, filter: curFilter });
            render();
            if(j < 2) await new Promise(r => setTimeout(r, 1000));
        }
    }

    function render() {
        cvs.width = APP.w; cvs.height = APP.h;
        ctx.fillStyle = "#fff"; ctx.fillRect(0,0,APP.w, APP.h);
        photos.forEach((p, i) => {
            const s = APP.slots[i]; ctx.save(); ctx.filter = p.filter;
            const r = Math.max(s.w/p.img.width, s.h/p.img.height);
            const dw = p.img.width*r, dh = p.img.height*r;
            ctx.beginPath(); ctx.roundRect(s.x, s.y, s.w, s.h, 12); ctx.clip();
            ctx.drawImage(p.img, s.x-(dw-s.w)/2, s.y-(dh-s.h)/2, dw, dh); ctx.restore();
        });
        if(curFrame) ctx.drawImage(curFrame, 0, 0);
        ctx.font = "80px serif"; ctx.textAlign = "center";
        stickers.forEach(s => ctx.fillText(s.e, s.x, s.y));
    }

    // DRAG & DELETE LOGIC
    const handleStart = (e) => {
        const r = cvs.getBoundingClientRect(), sc = APP.w / r.width;
        const ev = e.touches ? e.touches[0] : e;
        const mx = (ev.clientX - r.left)*sc, my = (ev.clientY - r.top)*sc;
        activeDrag = stickers.find(s => Math.hypot(s.x - mx, s.y - my) < 60);
    };
    const handleMove = (e) => {
        if(!activeDrag) return;
        if(e.cancelable) e.preventDefault();
        const r = cvs.getBoundingClientRect(), sc = APP.w / r.width;
        const ev = e.touches ? e.touches[0] : e;
        activeDrag.x = (ev.clientX - r.left)*sc; activeDrag.y = (ev.clientY - r.top)*sc;
        render();
    };
    wrap.addEventListener('mousedown', handleStart);
    wrap.addEventListener('touchstart', handleStart);
    window.addEventListener('mousemove', handleMove);
    window.addEventListener('touchmove', handleMove, {passive: false});
    window.addEventListener('mouseup', () => activeDrag = null);
    window.addEventListener('touchend', () => activeDrag = null);

    // Double Click to Delete
    wrap.ondblclick = (e) => {
        const r = cvs.getBoundingClientRect(), sc = APP.w / r.width;
        const mx = (e.clientX - r.left)*sc, my = (e.clientY - r.top)*sc;
        const idx = stickers.findIndex(s => Math.hypot(s.x - mx, s.y - my) < 60);
        if(idx !== -1) { stickers.splice(idx, 1); render(); }
    };

    function buildUI() {
        const fg = document.getElementById('filter-grid');
        APP.filters.forEach(f => {
            const d = document.createElement('div'); d.className = 'chip'; d.innerText = f.n;
            d.onclick = () => { curFilter = f.f; v.style.filter = f.f; document.querySelectorAll('#filter-grid .chip').forEach(c => c.classList.remove('active')); d.classList.add('active'); };
            fg.appendChild(d);
        });

        const sg = document.getElementById('sticker-grid');
        APP.stickers.forEach(s => {
            const u = document.createElement('div'); u.className = 'sticker-unit'; u.innerText = s;
            u.onclick = () => { stickers.push({e:s, x:APP.w/2, y:APP.h/2}); render(); };
            sg.appendChild(u);
        });

        const frg = document.getElementById('frame-grid');
        APP.frames.forEach(f => {
            const d = document.createElement('div'); d.className = 'chip'; d.innerText = f.n;
            d.onclick = () => {
                const fc = document.createElement('canvas'); fc.width=APP.w; fc.height=APP.h;
                const fctx = fc.getContext('2d'); fctx.fillStyle = f.c; fctx.fillRect(0,0,APP.w,APP.h);
                fctx.globalCompositeOperation = 'destination-out';
                APP.slots.forEach(s => { fctx.beginPath(); fctx.roundRect(s.x, s.y, s.w, s.h, 10); fctx.fill(); });
                fctx.globalCompositeOperation = 'source-over'; fctx.fillStyle = f.t;
                fctx.font='bold 22px Plus Jakarta Sans'; fctx.textAlign='center'; fctx.fillText('#IZIINNN', 266, 1545);
                curFrame = fc; render();
                document.querySelectorAll('#frame-grid .chip').forEach(c => c.classList.remove('active'));
                d.classList.add('active');
            };
            frg.appendChild(d);
        });
    }

    function resetApp() { photos=[]; step=0; stickers=[]; curFrame=null; render(); }
    function downloadPhoto() { const a = document.createElement('a'); a.download='Fotoweb-by-azka.png'; a.href=cvs.toDataURL(); a.click(); }
    buildUI(); render();
</script>
</body>
</html>